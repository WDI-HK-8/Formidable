app.controller('ListFormsCtrl', ['$scope', '$http','$auth','$location', function($scope, $http, $auth, $location){
  
  url = "<%= ENV['URL'] %>" || 'http://localhost:3000'

  $scope.noForms = false;
  $scope.user = '';
  $auth.validateUser().then(function(response) {
    $scope.user = response
    $http.get(url + '/users/' + $scope.user.id + '/forms').success(function(resp) {
      $scope.forms = resp;
      if(!resp.length) {
        $scope.noForms = true;
      }
    });
  }).catch(function(response) {
    console.log(response);
  });

  $scope.form = {};
  $scope.createForm = function() {
    $http.post(url + '/users/' + $scope.user.id + '/forms',$scope.form).success(function(response) {
      console.log(response)
      $location.path('forms/' + response.id + '/edit');
    }).error(function(response){
      alert("write something you douche");
    });
  }

  $scope.goToForm = function(form) {
    $location.path('forms/' + response.id + '/edit');
  }

  $scope.delete = function(form) {
    if(confirm('This will delete all data associated with this form, and is irreversible')) {
      $scope.forms.splice($scope.forms.indexOf(form),1);
      $http.delete(url + '/forms/' + form.id).success(function(response) {
        console.log(response);
      });
    }
  };

}]);